# lammps_education_gcmc_win

------------------------------------------------------------------------------
■ GCMC（グランドカノニカルモンテカルロシミュレーション）

□ 入力ファイルのダウンロード
    by-student-2017 の lammps_education_gcmc_win (https://github.com/by-student-2017/lammps_education_gcmc_win) から入力ファイルをダウンロードして解凍する。右側の[Clone or download]をクリックしていただくと、Download ZIP が表示されます
  
□ シミュレーションの実行
1. 各種のフォルダの中にあるrun.batをダブルクリックすれば計算が走る
2. cfgをOvitoで開けば構造が得られる
3. plotと記載のあるファイルをダブルクリックすれば図が得られる
  ※ 温度が目的の値になっているか、エネルギーが一定の値になっているかを確認してみてください
※ 以上の手順は、data.chにある原子の情報を書きかえれば他の炭化水素（C-H）でも同様に計算が可能です（Avogadroなどのフリーソフトを用いて構造のファイル（data.ch）を作られる方もいます）

□ tutorial_7_gcmc_He
  Heガスの絶対吸着量のシミュレーション
  最後に出力されるデータ（log.lammpsにも同様です）
  最初の3列はステップ数、温度[K]、圧力[bar]です。
  最後の4列は左から順にHe原子の数、C原子の数、H原子の数、wt%となっています。
  cfgのファイルはgcmcの付いてないものが平衡化処理（構造が安定するまでまつ処理）のもので、gcmcと付いたものがHeガスを入れていった場合になります。

□ tutorial_7_gcmc_Ar
  Arガスの絶対吸着量のシミュレーション
  最初の3列はステップ数、温度[K]、圧力[bar]です。
  最後の4列は左から順にAr原子の数、C原子の数、H原子の数、wt%となっています。

□ tutorial_7_gcmc_N2
  窒素分子（N2）を一組として近似した場合のN2ガス充填のシミュレーション
  N2の分子を一つの球としてOvito上で表示されます（元素名はNにしてある）
  最初の3列はステップ数、温度[K]、圧力[bar]です。
  最後の4列は左から順にN2分子の数、C原子の数、H原子の数、wt%となっています。

□ tutorial_7_gcmc_H2
  水素分子（H2）を一組として近似した場合のH2ガスの絶対吸着量のシミュレーション
  H2の分子を一つの球としてOvito上で表示されます（元素名はHにしてある）
  最初の3列はステップ数、温度[K]、圧力[bar]です。
  最後の4列は左から順にH2分子の数、C原子の数、H原子の数、wt%となっています。

□ tutorial_7_gcmc_CO2
  二酸化炭素分子（CO2）を一組として近似した場合のCO2ガスの絶対吸着量のシミュレーション
  CO2の分子を一つの球としてOvito上で表示されます（元素名はOにしてある）
  最初の3列はステップ数、温度[K]、圧力[bar]です。
  最後の4列は左から順にCO2分子の数、C原子の数、H原子の数、wt%となっています。

※ Heガスは死容積の測定に使われます。
※ 実験では過剰吸着量（excess adsorption uptake）であるため、実験値と比較するためには吸着材が無い時のガスの充填量を絶対吸着量から引く必要があります。
※ この例ではmuの値にMOPACの計算で得られたフェルミ準位近傍のエネルギーを用いていますが、マニュアル（https://lammps.sandia.gov/doc/fix_gcmc.html）にある式μid=kT*ln（ΦPλ^3/kT）で計算した値を入力することが正しいと思われます。ですが、この入力例のようにgcmcの部分で圧力（pressure）を指定している場合はmuの値が無視されるとlammpsのマニュアルに書かれている。
※ 実験値よりもガスが吸着している場合には、計算に用いているポテンシャルがレナードジョーンズ（lj）ポテンシャルだけではないため、化学吸着の効果が出ている可能性があります。ガス-ガス間はljポテンシャルのみになっています。
※ ファイルの中を見ていただければ、他のガスでも同様の計算は可能です。ただし、このファイルでの計算では、CO2などの分子は一つの球に近似したパラメータを用いての計算になります（計算しているコードはlammpsではありませんが、論文でもこのようにして計算されている例が多くあります）。きちんと分子として扱いたい場合は、左欄の「Lammps (GCMC, Mg(OH)2)」などを参考にしてください。
※ replicate 1 1 1 の値を変えるとその数値の分だけ単位胞の構造が並びます。
※ ガスが充填していくと、lammpsの数値計算上、ガスの増減で温度も変動します。in.lmpでの tfac_insert の後の数値を変えたり、"variable   temp2 index"の後の値を変えるなどしてみてください。tfac_insertの後の値を変えることが正しいはずですが、この入力例の場合、ほとんど機能しません。temp1は加圧時（NPTでの制御）の目標とする温度です。

--------------------------------------------------
■ 過剰吸着量の計算のためのガスのみのGCMC計算

□ tutorial_7_gcmc_He_only
  100^3 [Angstrom^3]の空間にHeガスを充填した場合のシミュレーション
  最後に出力されるデータ（log.lammpsにも同様です）
  最初の3列はステップ数、温度[K]、圧力[bar]です。
  最後の4列は左から順にHe原子の数、温度となっています。

□ tutorial_7_gcmc_N2_only
  120^3 [Angstrom^3]の空間にHeガスを充填した場合のシミュレーション
  最後に出力されるデータ（log.lammpsにも同様です）
  最初の3列はステップ数、温度[K]、圧力[bar]です。
  最後の4列は左から順にN2分子の数、温度となっています。

□ tutorial_7_gcmc_H2_only
  110^3 [Angstrom^3]の空間にHeガスを充填した場合のシミュレーション
  最後に出力されるデータ（log.lammpsにも同様です）
  最初の3列はステップ数、温度[K]、圧力[bar]です。
  最後の4列は左から順にH2分子の数、温度となっています。

※ 今回は、空間の大きさと初期に配置する原子数の数を調整して、目的の温度で収束しやすくなるようにしています。マニュアル（https://lammps.sandia.gov/doc/fix_gcmc.html）にはin.lmpでのtfac_insert の後の数値を変えるとの記述があります（https://lammps.sandia.gov/threads/msg64926.html なども参考になる）。
※ 一連のGCMCの入力ファイルの設定については、これが最適というわけではありません。そのため、さらに良い入力ファイルとなるように勉強を進めてください。よろしくお願い致します。

□ 収束するためのヒント
  温度や圧力の条件を変えたときに上手く目的の温度に収束しないことがあります。以下に優先的に値を色々と変えてみるパラメータを示します。
・variable   temp2 index 100.5 # GCMCとその前処理の段階で設定している温度。吸着するガスから吸着材の熱が取られているのでより大きな値にしている。
・variable   pres index 1.0 # 0.1 MPa (bar units)
・variable   tfac index 1.0  # 温度が下がる場合は大きな値にする
・variable   fs   index 0.0005 # 1ステップの時間。途中でエラーが出る場合にはより小さな値にする
・variable   ps   index 20 # 各処理（昇圧やGCMC計算など）での計算時間。まだ収束しない場合はより大きな値にする
・${tdamp} # 温度の収束が上手くいかない場合はこの値を${fs}*100から変える（特にGCMCのところ）
  fsの値は"variable   fs   index 0.0005"で定義している。
・variable   pdamp equal ${fs}*1000 # 圧力の収束が上手くいかない場合はこの値を変える
  複数ある"run ${nstep}"での${nstep}を数値にしてもよい。上の例では${ps}/${fs}=20/0.0005となるようにしている。
・fix f2 gas gcmc 100 100 100 1 761341 ${temp} ${mu} ${disp} pressure ${pres} tfac_insert ${tfac}
  50 50 50 の部分を変えると挿入されたり削除されたりする原子や分子の更新頻度が変わる（詳細はマニュアルを参照ください）
・fix f2 gas gcmc 50 50 50 3 761341 ${temp2} ${mu} ${disp} pressure ${pres} tfac_insert ${tfac}
  50 50 50 の部分を変えると挿入されたり削除されたりする原子や分子の更新頻度が変わる（詳細はマニュアルを参照ください）

------------------------------------------------------------------------------